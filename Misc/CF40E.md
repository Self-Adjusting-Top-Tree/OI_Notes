### CF40E（*$\color{red}{2500}$）

特殊判断某一行或某一列的数全部填完，且这行或这列所有数乘积不为 $-1$ 的情况，该情况无解。同样还有若 $n\not\equiv m\pmod 2$，则奇偶性分析后可知显然也无解。

先考虑一个简单一些的子问题：若 $k<\min(n,m)$，那么应该如何解决？很显然，此时至少存在一行和一列使得这一行和一列没有被填任何一个数。把这一行一列删去，剩下的数任意填写，最后用这一行一列的唯一填法把答案补充完整即可。

现在考虑 $k<\max(n,m)$ 的母问题。此时仍然存在一行**或**一列使得这一行**或**一列没有被填任何一个数。删除这一行**或**一列，那么剩下的每一行**或**每一列都可以任意填写答案，用最后这个行**或**列的唯一填法把答案补充完整。因此问题做完，通过预处理 $2$ 的幂次可以做到 $O(n+m)$ 解决问题。