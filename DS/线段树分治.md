终于把这个坑填了。。。

---

线段树分治一个比较基础的问法是维护一些信息，信息只会在一段连续的时刻出现，然后询问某一时刻信息的一些关系。这个时候用一个分治来离线的处理。

以一个具体的问题为例：[P5787 二分图 /【模板】线段树分治](https://www.luogu.com.cn/problem/P5787)

题意是现在有 $n$ 个点 $m$ 条边，每一条边只会在 $[l_i,r_i)$ 这个特定的时间区间出现。现在对于任意一个时刻，问这个时刻所有出现的边是否形成一张二分图。

直接做是困难的，考虑上线段树分治。

首先维护一个时间线段树，和普通线段树类似的，假设当前线段树结点 $u$ 覆盖 $[l_u,r_u]$ 这个时间范围，而一条边 $e$ 出现的时间范围为 $[l,r]$，若有 $[l_u,r_u]\subseteq[l,r]$，则直接把 $e$ 这条边挂到线段树上的 $u$ 结点上。否则继续递归线段树处理。

当前分治函数为 $F(l,r,rt)$ 表示当前分治到了 $[l,r]$ 区间，在时间线段树上的 $rt$ 结点。此时维护一个扩展域并查集和一个操作时间栈。对于 $[l,r]$ 区间，先把线段树上 $rt$ 点挂的边加入扩展域并查集内，如果此时并查集内出现环，那么 $[l,r]$ 区间内所有时刻必然均不可能成为二分图，全部记录答案不存在。

若加入完所有边后，并查集内仍然无环（即图仍然是二分图），那么：

+ 若 $l=r$ 即递归到叶子结点，那么该时刻图一定为二分图。
+ 否则开始分治，记 $mid=\lfloor\frac{l+r}2\rfloor$，分别递归区间 $[l,mid]$ 和区间 $[mid+1,r]$ 处理。

最后把操作时间栈回退到本次分治初始时刻，并将并查集撤销版本即可。