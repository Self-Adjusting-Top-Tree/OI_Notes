## 4. 贪心

### 4.1 简单贪心

### 4.2 贪心的技巧

### 4.3 博弈

#### 4.3.11 CF1934D2 XOR Break — Game Version（4 / 2 / 7） ####

直接猜结论: 当且仅当 $2\mid \text{popcount}(x)$ 时先手必胜, 否则先手必败. 交互策略是每一次拆出一个 $2^{\text{highbit}(x)}$. 

#### 4.3.12 AGC002E Candy Piles（8 / 3 / 10）

直接做比较困难. 考虑给 $a$ 数组从大到小排序, 然后构建模型, 从左往右第 $i$ 列从下往上放 $a_i$ 个石子. 如下图所示: 

![image](https://s2.ax1x.com/2019/10/13/uxC5ND.png)

然后此时两个操作被转化为: 

+ 删去最左边一列所有的石子
+ 删去最下面一行所有的石子

发现还是不太好做, 把这些石子看做是一个网格图, 网格图的外侧边界整体呈左上 - 右下倾斜. 然后经典的博弈套路, 分析每个点的必胜 / 必败态. 

![image](https://s2.ax1x.com/2019/10/13/uxite0.png)

此时若原点为必胜点, 则后手必胜, 否则先手必胜. 直接模拟该过程时间复杂度为 $O(\sum a_i)$ 过不去, 考虑在此基础上优化. 观察到必胜点和必败点的分布十分的有规律, 除去右上边界上的点外, 每一条斜率为 $1$ 的直线上所有点的必胜 / 必败态均相等. 于是考虑直接从原点出发暴力往右上跳, 走到边界内的最后一个点, 然后求其的必胜 / 必败态. 这个部分是简单的, 只需要找出其向上 / 向右可以走的长度, 然后根据其奇偶性来判定其必胜 / 必败态即可. 总时间复杂度为 $O(n)$, 可以通过. 

#### 4.3.13 ARC116F Deque Game（7 / 4 / 9） ####

先考虑只有一个数列的情况: 

**一、假设 Takahashi 是先手**

假设当前只有一个长度为 $n$ 的序列 $a$, 则先考虑这样的一个策略: 假设先手取走了序列某一侧的元素, 则后手一定可以取走对侧的元素, 这样可以将最后剩余的唯一元素局限在序列的中部. 

对 $n$ 的奇偶性分类讨论: 

**（1）$2\nmid n$**

先模拟 $n$ 比较小的情况. $n=1$ 时答案显然. $n=3$ 时: 

+ 若此时先手取走了最左侧的 $a_1$, 那么此时后手可以选择取走 $a_2$ 或 $a_3$ 中的某个元素. 在最优策略下, 最终数列剩下的元素显然是 $\min(a_2,a_3)$. 
+ 若此时先手取走了最右侧的 $a_2$, 那么此时后手可以选择取走 $a_1$ 或 $a_2$ 中的某个元素. 在最优策略下, 最终序列剩下的元素显然是 $\min(a_1,a_2)$. 

而此时先手也会选择最优策略最大化答案, 因此显然此时答案为 $\max(\min(a_1,a_2),\min(a_2,a_3))$. 

扩展到 $n=2k+1$ 的情况: 假设此时先手取走了最左边的石子, 那么: 

+ 后手取最右边的石子. 那么规约到 $n=2k-1$ 的情况递归处理. 
+ 后手取最左边的石子. 激情的左右脑博弈之后可以发现此时有两种情况: 
  + 先手继续取最左边的石子. 那么此时情况比较偏离轨道, 但是倒推一下, 若后手取最左边的石子比取最右边的石子更优, 那么此时其肯定是希望先手取最左侧的石子以达到其目标的. 而若先手取了最左侧的式子就正好符合了后手的心意. 
  + 先手取右边的石子, 回到情况开始. 因此此时情况形如: 后手一直取左边石子, 先手一直取右边石子, 局面保持平衡, 直到某一时刻后手取左边石子不优, 打破局面取右侧石子, 此时又规约到了 $n=2k+1-2p$ 时的情况. 

先手第一步取右侧的石子也同理. 因此最终都规约到了 $n=3$ 的情况. 这堆石子的最优解即形如: 找出石子的中位编号 $\text{mid}$, 最终的答案即为 $\max(\min(a_{\text{mid}-1},a_{\text{mid}},\min(a_{\text{mid}},a_{\text{mid}+1})))$. 

**（2）$2\mid n$**

同样还是模拟 $n$ 比较小的情况. $n=2$ 时先手可以直接决定最后保留的石子, 答案为 $\max(a_1,a_2)$. 

扩展到 $n=2k$ 的情况: 假设此时先手取走了最左边的石子, 那么: 

+ 后手取最右边的石子. 那么规约到 $n=2k-2$ 的情况递归处理. 
+ 后手取最左边的石子. 激情的左右脑博弈之后可以发现此时有两种情况: 
  + 先手继续取最左边的石子. 那么此时情况比较偏离轨道, 但是倒推一下, 若后手取最左边的石子比取最右边的石子更优, 那么此时其肯定是希望先手取最左侧的石子以达到其目标的. 而若先手取了最左侧的式子就正好符合了后手的心意. 
  + 先手取右边的石子, 回到情况开始. 因此此时情况形如: 后手一直取左边石子, 先手一直取右边石子, 局面保持平衡, 直到某一时刻后手取左边石子不优, 打破局面取右侧石子, 此时又规约到了 $n=2k-2p$ 时的情况. 

先手第一步取右侧的石子也同理. 因此最终都规约到了 $n=2$ 的情况. 这堆石子的最优解即形如: 找出石子的中位编号中相对较小的编号 $\text{mid}$, 最终的答案即为 $\max(a_\text{mid},a_\text{mid+1})$. 

**二、假设 Aoki 是先手**

好吧其实和之前的没啥差别（）

**（1）$2\nmid n$**

$n=1$ 时答案为 $a_1$, $n=3$ 时答案为 $\min(\max(a_1,a_2),\max(a_2,a_3))$, 扩展到 $n=2k+1$ 的情况: 设中位数编号为 $\text{mid}$, 则答案即为 $\min(\max(a_{\text{mid}-1},a_\text{mid}),\max(a_\text{mid},a_{\text{mid}+1}))$. 

**（2）$2\mid n$**

$n=2$ 时答案为 $\min(a_1,a_2)$, 扩展到 $n=2k$ 的情况: 设中位数编号相对较小的编号 $\text{mid}$, 则答案即为 $\min(a_\text{mid},a_{\text{mid}+1})$. 

----

然后回到 $n$ 个序列的情况: 假设其中存在一个长度为 $m$ 的序列, 那么: 

**（1）$2\mid m$**

+ 若 Takahashi 是先手, 则答案为 $\max(a_{\text{mid}},a_{\text{mid}+1})$. 
+ 若 Aoki 是先手, 则答案为 $\min(a_{\text{mid}},a_{\text{mid}+1})$. 

**（2）$2\nmid m$**

+ 若 Takahashi 是先手, 则答案为 $\max(\min(a_{\text{mid}-1,a_\text{mid}},\min(a_\text{mid},a_{\text{mid}+1})))$. 
+ 若 Aoki 是先手, 则答案为 $\min(\max(a_{\text{mid}-1,a_\text{mid}},\max(a_\text{mid},a_{\text{mid}+1})))$. 

---

对于第一种情况, 不论哪一方先操作, 一定都比后操作对自己更有利. 

对于第二种情况, 考虑经典套路, 对所有 $a_{\text{mid}-1},a_\text{mid},a_{\text{mid}+1}$ 三个元素之间的偏序关系进行分类讨论, 最终可以发现不论哪一方先操作, 一定都比后操作对自己更不利. 

然后又可以分析得出, 若某个人操作了一个序列, 那么另一方一定可以对称的操作序列, 使得序列的关系不变. 因此一个最优的策略是给所有的序列按照一定顺序排序, 然后双方按顺序轮流对一个序列执行操作. 

于是现在的问题在于, 怎么快速的找出这个操作顺序. 这一步是比较容易的. 考虑经典套路, 对每个长度为偶数的序列求出 Takahashi 作为先手选这个序列的代价和 Aoki 作为先手选这个序列的代价, 然后将其作差, 并按照贡献从大到小排序. 因为 Takahashi 是先手, 所以她一定会选择所有序列中对自己贡献最大的, 然后 Aoki 会选择所有序列中对自己贡献第二大的, 依次类推……而对于长度为奇数的序列, 两个人操作完之后不会影响先后手的顺序, 且这些序列作为先手一定给自己带来的贡献更大, 因此 Takahashi 作为先手一定会把所有这些序列都先手操作掉. 

#### 4.3.14 CF794E Choosing Carrot（7 / 4 / 9）

前面的部分和 4.3.13 一样, 问题在于此时 Takahashi 可以先执行 $k$ 次操作. 

此时容易计算出 $k=0$ 和 $k=1$ 时的答案, 而若 $k=p$（$p\ge 2$）, 则可以规约到 $k=p-2$ 时的情况, 然后在此基础上: 

+ 取一次左侧和一次右侧, 那么和 $k=p-2$ 的情况完全相同. 
+ 取两次左侧, 那么此时相当于是 $k=p-2$ 的基础上整体向左平移, 答案可以再往左取一个位置. 
+ 取两次右侧, 那么此时相当于是 $k=p-2$ 的基础上整体向右平移, 答案可以再往右取一个位置. 

容易发现上面这个东西可以做到 $O(n)$ 递推转移, 注意需要特判 $k=n-1$, 此时答案即为 $\max\limits_{i=1}^n a_i$. 

#### 4.3.15 CF1776I Spinach Pizza（5 / 4 / 5）

前置知识: 简单计算几何

有经典结论: 在一个凸包上, 每次选择最小的三角形并将其顶点从凸包上删除, 得到的所有三角形的面积单调不下降. 证明拿叉积算一下就行. 

于是容易证明, 根据这个策略, 若 $n$ 为偶数则先手必胜, 否则先手会多取走一个三角形, 后手必胜. 

$n$ 很小, 所以直接暴力模拟该过程, 时间复杂度为 $O(n^2)$ 可以通过. 

### 4.4 杂题

#### 4.4.1 AGC029B Powers of two（3 / 3 / 7）

首先将数组升序排序. 然后考虑对于每个位置 $i$, 对于所有比其靠前的位置 $j$, 最多存在一个 $j$ 使得 $a_i+a_j$ 是 $2$ 的幂次. 证明显然. 

然后再从大到小考虑, 对每个数 $a_i$ 而言, 若其可以和 $a_j$ 匹配（$j<i$）, 则若其放弃了匹配机会, 则其再也无法和其他数进行匹配. 而放弃这个匹配机会后 $a_j$ 最多能贡献 $1$ 的答案, 不如和 $a_i$ 匹配以确保贡献 $1$ 的答案. 因此直接贪心的正确性有保障. 

直接模拟时间复杂度为 $O(n^2)$, 考虑优化: 容易观察到在值域范围内 $2$ 的幂次只有 $O(\log V)$ 个, 因此想到直接从大到小暴力枚举所有 $2$ 的幂次, 然后用双指针扫描贪心的选出尽可能多的组合, 时间复杂度为 $O(n\log V)$ 可以通过. 

#### 4.4.2 P13509 [OOI 2024] Almost Certainly（6 / 4 / 9）

Source2: 代码源 20251004 模拟赛 T2

注意到题目给出性质 **保证答案必然存在** 以及 $\forall i\in[1,n],b_i\le a_i$, 因此考虑利用该性质解题. 

考虑到对于所有满足 $a_i=b_i$ 的位置 $i$, 不如直接将其匹配掉. 此时只会剩下若干个满足 $a_i<b_i$ 的位置. 

特判掉此时不存在 $a_i<b_i$ 的位置 $i$ 的情况, 然后按 $a_i$ 的值从小到大对二元组 $(a_i,b_i)$ 排序. 假设此时选择了 $a_i$ 和 $b_j$ 并将其消去, 假设此时可以匹配成功, 那么总代价将会减少 $a_i-b_j$. 为了让最后的代价和最小, 肯定希望让减去的这个代价 $a_i-b_j$ 的值尽量大. 因此此时肯定会贪心的让 $i\ge j$. 

然后考虑什么时候可以把 $a_i$ 和 $b_j$ 消去然后剩下的匹配. 容易想到贪心策略是直接按顺序两两匹配, 此时需要满足条件 $b_{j+1}\le a_j,b_{j+2}\le a_{j+1},\ldots,b_i\le a_{i-1}$. 于是想到经典套路: 把每一个二元组 $(a_i,b_i)$ 看做是一个区间 $[b_i,a_i]$. 此时前面给出的条件可以看作是**第 $j$ 个区间到第 $i$ 个区间组成了一个连续段**, 而此时 $a_i-b_j$ 的值就是**这个连续段的长度**. 为了让这个长度最大, 显然只需要找出所有连续段中最长的那一段 $[j,i]$, 从序列中删除 $a_i$ 和 $b_j$, 剩下的部分按顺序两两匹配为最优解. 

此时答案即为 $\sum\limits_{i=1}^m(a_i-b_i)$ 减去最长连续段的长度, 直接模拟这个过程可以做到 $O(n^2)$ 求解. 

考虑到题目按顺序依次询问了所有的前缀, 而从长度为 $i-1$ 的前缀扩展到长度为 $i$ 的前缀, 只会增加一个区间 $[b_i,a_i]$, 而维护的信息则是连续段. 因此想到用类似颜色段均摊的方法维护当前所有的连续段, 然后再开一个 `map` 维护当前所有连续段的长度, 总时间复杂度为 $O(n\log n)$ 可以通过该题. 